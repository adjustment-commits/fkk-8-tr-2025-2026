<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<!-- ✅ PWA設定 -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00a37a">
<link rel="apple-touch-icon" sizes="192x192" href="images/icon-192.png">
<link rel="apple-touch-icon" sizes="512x512" href="images/icon-512.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Next Season Fitness">

<title>Next Season Fitness｜FKK #8</title>

<style>
:root {
  --bg: #f7f7f7;
  --text: #222;
  --accent: #00a37a;
  --card: #fff;
  --border: #ddd;
}
body {
  margin: 0;
  background: var(--bg);
  font-family: 'Noto Sans JP', sans-serif;
  color: var(--text);
  line-height: 1.6;
}
header {
  background: var(--accent);
  color: #fff;
  text-align: center;
  padding: 12px 0;
  font-size: 1.1rem;
  letter-spacing: 0.03em;
}
main {
  padding: 16px;
  max-width: 480px;
  margin: auto;
}
section {
  background: var(--card);
  border-radius: 10px;
  padding: 12px 16px;
  margin-bottom: 16px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}
h2 {
  font-size: 1rem;
  margin-bottom: 8px;
  color: var(--accent);
}
.exercise-list button {
  width: 100%;
  background: #fff;
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 10px;
  text-align: left;
  margin-bottom: 6px;
  font-size: 0.95rem;
}
.exercise-list button:hover {
  background: #f0fdf7;
  border-color: var(--accent);
}
label {
  font-size: 0.9rem;
  display: block;
  margin-top: 10px;
}
input[type="number"], textarea {
  width: 100%;
  padding: 8px;
  font-size: 0.9rem;
  border: 1px solid var(--border);
  border-radius: 6px;
  margin-top: 4px;
}
input[type="range"] {
  width: 100%;
  margin-top: 6px;
}
.save-btn {
  background: var(--accent);
  color: #fff;
  border: none;
  width: 100%;
  padding: 12px;
  font-size: 1rem;
  border-radius: 8px;
  margin-top: 12px;
}
.save-btn:hover { opacity: 0.9; }

.feedback {
  background: #eefdf4;
  border-left: 4px solid var(--accent);
  padding: 8px;
  margin-top: 10px;
  font-size: 0.9rem;
  border-radius: 6px;
}

/* Footer */
footer {
  text-align: center;
  font-size: 0.8rem;
  color: #888;
  margin-top: 20px;
  padding: 8px 0 20px;
}

/* Modal */
.modal {
  display: none;
  position: fixed;
  z-index: 100;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.4);
}
.modal-content {
  background: var(--card);
  border-radius: 10px;
  padding: 16px;
  margin: 60px auto;
  width: 90%;
  max-width: 400px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}
.modal-content img {
  width: 100%;
  border-radius: 8px;
  margin-bottom: 10px;
}
.close {
  float: right;
  font-size: 1.2rem;
  font-weight: bold;
  cursor: pointer;
  color: var(--accent);
}
.close:hover { opacity: 0.7; }
</style>
</head>

<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("service-worker.js");
  });
}
</script>

<body>
<header>Next Season Fitness｜FKK #8</header>
<main>

<!-- ウォーミングアップ -->
<section>
  <h2>練習｜ウォーミングアップ</h2>
  <div class="exercise-list">
    <button data-ex="リブゲージ体幹5種">リブゲージ体幹5種（①〜⑤）</button>
  </div>
</section>

<!-- DAY1 -->
<section>
  <h2>DAY1｜呼吸性持久 × リブ安定</h2>
  <div class="exercise-list">
    <button data-ex="HEXバー・スプリントDL">HEXバー・スプリントDL</button>
    <button data-ex="自走式トレッドミル 10s×8">自走式トレッドミル 10s×8</button>
    <button data-ex="ハンドリリースプッシュアップ">ハンドリリースプッシュアップ</button>
    <button data-ex="スプリント・ランジステップ">スプリント・ランジステップ</button>
    <button data-ex="デッドバグマーチ">デッドバグマーチ</button>
  </div>
</section>

<!-- DAY2 -->
<section>
  <h2>DAY2｜可動性 × 反応性</h2>
  <div class="exercise-list">
    <button data-ex="MBローテーショントス">MBローテーショントス</button>
    <button data-ex="スライドボード・ラテラルランジ">スライドボード・ラテラルランジ</button>
    <button data-ex="トレッドミル 15s×10">トレッドミル 15s×10</button>
    <button data-ex="MBチェストパス→リバウンドキャッチ">MBチェストパス→リバウンドキャッチ</button>
    <button data-ex="リブスライド・ランジ">リブスライド・ランジ</button>
  </div>
</section>

<!-- DAY3 -->
<section>
  <h2>DAY3｜反応持久＋リカバリー</h2>
  <div class="exercise-list">
    <button data-ex="トレッドミル 15s×45s×8">トレッドミル 15s×45s×8</button>
    <button data-ex="HEXバー・スプリントDL（軽負荷）">HEXバー・スプリントDL（軽負荷）</button>
    <button data-ex="リブリード・ヒップロール">リブリード・ヒップロール</button>
    <button data-ex="サイドリブ・プランク">サイドリブ・プランク</button>
    <button data-ex="リアクション・バウンス">リアクション・バウンス</button>
  </div>
</section>

<!-- 入力 -->
<section>
  <h2>パフォーマンス入力</h2>
  <label>CMJ（cm）</label><input type="number" id="cmj">
  <label>RSI（m/s）</label><input type="number" id="rsi" step="0.01">
  <label>平均心拍（bpm）</label><input type="number" id="avgHR">
  <label>最大心拍（bpm）</label><input type="number" id="maxHR">
  <label>回復時間（秒）</label><input type="number" id="recoveryTime">
  <h2>主観RPE（疲労度）</h2>
  <input type="range" id="rpe" min="0" max="10" step="1"><div id="rpeVal">RPE: 0</div>
  <label>コメント</label><textarea id="comment" rows="3"></textarea>
  <button class="save-btn" id="saveBtn">データを保存</button>
  <div class="feedback" id="feedback"></div>
</section>

<footer>©︎adjustment-lab｜2025</footer>
</main>

<!-- モーダル -->
<div class="modal" id="exerciseModal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h3 id="exTitle"></h3>
    <img id="exImage" src="" alt="種目画像">
    <p id="exDetail"></p>
  </div>
</div>

<script>
// === 各種目詳細（既存＋追加：全文） ===
const details = {
  // 体幹5種（概要のみの集合ボタン）
  "リブゲージ体幹5種":
    "①リブシフト・プランク：胸郭の前後滑走と前方圧制御。10往復×2\n" +
    "②サイドリブ・プランク：側方安定・腹斜筋活性。各側10回×2\n" +
    "③リブローテーション・ベア：胸郭回旋と骨盤分離。各側8回×2\n" +
    "④リブリード・ヒップロール：肋骨主導→骨盤傾倒。各側8回×2\n" +
    "⑤リブローテーション・スフィンクス：肋骨スライドと肩甲帯分離。各側5回×2",

  // DAY1 既存
  "HEXバー・スプリントDL":
    "目的：股関節伸展と地面反力の連動／軸足膝の安定強化。\n" +
    "フォーム：背中を反らさず胸郭を前に出す。バーは脛の真横、重心は土踏まず。\n" +
    "負荷：60〜70%1RM ×5〜6回 ×3セット。\n" +
    "ミス：背部主導で引く／膝が内側に入る／つま先荷重。",
  "自走式トレッドミル 10s×8":
    "目的：最大出力反復とVO₂max刺激。\n" +
    "フォーム：胸郭を前に送り、頭部のブレ最小。呼気で肋骨下制→踏み込み。\n" +
    "負荷：全力10秒→レスト20秒 ×8本。\n" +
    "ミス：腕振り先行／呼吸停止／腰主導の過前傾。",
  "ハンドリリースプッシュアップ":
    "目的：胸郭前方圧の維持と上肢出力耐性。\n" +
    "フォーム：胸を床に一度置き、両手を軽く離してから胸郭で押し返す。\n" +
    "負荷：15回 ×3セット。\n" +
    "ミス：腰反り／肘主導／肩すくみ。",
  "スプリント・ランジステップ":
    "目的：地面反力→骨盤→胸郭への同期。切り返しリズム強化。\n" +
    "方法：前ランジ姿勢から瞬時に押し返して反対脚を前に。上体は静。\n" +
    "回数：各脚6〜8回 ×3セット。\n" +
    "キュー：『前足で地面を素早く“押し返す”』",
  "デッドバグマーチ":
    "目的：呼吸下での体幹安定と四肢分離。\n" +
    "フォーム：腰椎ニュートラルで背面を床に密着。息を吐き肋骨を下げたまま脚を交互。\n" +
    "負荷：各脚10回 ×2セット。\n" +
    "ミス：腰浮き／胸郭の前方移動／呼吸停止。",

  // DAY2 既存
  "MBローテーショントス":
    "目的：胸郭主導の回旋出力。\n" +
    "フォーム：軸足荷重→肋骨で“押し投げ”。骨盤先行を抑え、胸郭で先に回す。\n" +
    "負荷：2〜3kg ×8回 ×3セット。\n" +
    "ミス：腕だけで投げる／踏ん張り固定で回旋が止まる。",
  "スライドボード・ラテラルランジ":
    "目的：股関節外転・内転の滑走強化と側方制動。\n" +
    "フォーム：滑る脚は長く伸展、軸脚で受け止める。胸郭が後退しない。\n" +
    "負荷：10回 ×3セット。\n" +
    "ミス：体幹の側屈／膝内倒／つま先荷重。",
  "トレッドミル 15s×10":
    "目的：呼吸筋への持続刺激と酸素摂取効率の向上。\n" +
    "フォーム：胸郭を前へ押し出し、軽い腕振り。足置きでなく“押し”で進む。\n" +
    "負荷：全力15秒→レスト30秒 ×10本。\n" +
    "ミス：前傾過多／腰主導／ピッチだけで無理に上げる。",
  "MBチェストパス→リバウンドキャッチ":
    "目的：胸郭前方出力×反応キャッチの統合。\n" +
    "フォーム：胸で押し出し→即リバウンド反応でキャッチ。呼吸を止めない。\n" +
    "負荷：12回 ×3セット。\n" +
    "ミス：腕先行／脚で踏ん張る固定化。",
  "リブスライド・ランジ":
    "目的：胸郭の横滑り（リブスライド）と前脚安定の同調。\n" +
    "方法：ランジ姿勢で胸郭だけ左右にスライド。骨盤は後追いで微調整。\n" +
    "回数：10往復 ×2セット。\n" +
    "キュー：『肋骨で“車体”を横に送る』",

  // DAY3 既存
  "トレッドミル 15s×45s×8":
    "目的：回復力・心拍コントロール（テンポ走×休息）。\n" +
    "フォーム：呼気で肋骨下制→踏み込み。吸気で胸郭拡張しつつ肩はリラックス。\n" +
    "負荷：全力15秒→45秒レスト ×8本。HRmax 80〜85%を目安。\n" +
    "ミス：呼吸浅い／肩主導の過緊張。",
  "HEXバー・スプリントDL（軽負荷）":
    "目的：出力維持しつつ疲労下での軸安定確認。\n" +
    "フォーム：胸郭前方・背部フラットは同じ。テンポは速すぎない。\n" +
    "負荷：40〜55%1RM ×5回 ×2〜3セット。\n" +
    "ミス：勢い任せ／トップでの抜け。",
  "リブリード・ヒップロール":
    "目的：肋骨主導→骨盤の受動的ロールを体感。\n" +
    "方法：仰向け・膝90°。肋骨を先に送ってから骨盤を倒す。\n" +
    "回数：各側8回 ×2セット。\n" +
    "ミス：骨盤から先に倒す／胸郭が固まる。",
  "サイドリブ・プランク":
    "目的：側方安定・腹斜筋と肋骨下制の同調。\n" +
    "方法：耳・肩・骨盤を一直線、上下に胸郭を微小スライド。\n" +
    "回数：各側10回 ×2セット。\n" +
    "ミス：腰反り／肩すくみ。",
  "リアクション・バウンス":
    "目的：接地反応と呼吸リズムの同期（軽プライオ）。\n" +
    "方法：小刻みジャンプで外的合図（声・メトロノーム）に合わせリズム変化。\n" +
    "時間：20〜30秒 ×3セット。\n" +
    "キュー：『胸郭の弾性で跳ね返す、息を止めない』",
};

// 画像（なければnoimageでOKにする運用）
const images = {
  "HEXバー・スプリントDL":"images/hex_dl.jpg",
  "自走式トレッドミル 10s×8":"images/treadmill10s.jpg",
  "ハンドリリースプッシュアップ":"images/pushup.jpg",
  "スプリント・ランジステップ":"images/sprint_lunge_step.jpg",
  "デッドバグマーチ":"images/deadbug.jpg",
  "MBローテーショントス":"images/mb_toss.jpg",
  "スライドボード・ラテラルランジ":"images/slide_lunge.jpg",
  "トレッドミル 15s×10":"images/treadmill15s.jpg",
  "MBチェストパス→リバウンドキャッチ":"images/mb_pass.jpg",
  "リブスライド・ランジ":"images/rib_slide_lunge.jpg",
  "トレッドミル 15s×45s×8":"images/treadmill15s.jpg",
  "HEXバー・スプリントDL（軽負荷）":"images/hex_dl_light.jpg",
  "リブリード・ヒップロール":"images/hip_roll.jpg",
  "サイドリブ・プランク":"images/core02.jpg",
  "リブゲージ体幹5種":"images/core_set.jpg",
  "リアクション・バウンス":"images/reaction_bounce.jpg"
};

// === モーダル表示 ===
const modal = document.getElementById('exerciseModal');
const exTitle = document.getElementById('exTitle');
const exDetail = document.getElementById('exDetail');
const exImage = document.getElementById('exImage');
const closeBtn = document.querySelector('.close');

document.querySelectorAll('.exercise-list button').forEach(btn=>{
  btn.addEventListener('click',()=>{
    const ex = btn.dataset.ex;
    exTitle.textContent = ex;
    exDetail.textContent = details[ex] || "詳細情報なし。";
    exImage.src = images[ex] || "images/noimage.jpg";
    exImage.alt = ex + " のイメージ";
    modal.style.display = 'block';
  });
});
closeBtn.onclick = () => modal.style.display = 'none';
window.onclick = e => { if(e.target == modal) modal.style.display = 'none'; };

// === RPEスライダー ===
const rpeSlider = document.getElementById('rpe');
const rpeVal = document.getElementById('rpeVal');
rpeSlider.addEventListener('input',()=>{ rpeVal.textContent = "RPE: " + rpeSlider.value; });

// === データ保存 ===
document.getElementById('saveBtn').addEventListener('click',()=>{
  const data = {
    cmj: document.getElementById('cmj').value,
    rsi: document.getElementById('rsi').value,
    avgHR: document.getElementById('avgHR').value,
    maxHR: document.getElementById('maxHR').value,
    recovery: document.getElementById('recoveryTime').value,
    rpe: rpeSlider.value,
    comment: document.getElementById('comment').value,
    date: new Date().toLocaleString()
  };
  localStorage.setItem('fitnessLog', JSON.stringify(data));
  showFeedback(data);
  alert('データを保存しました');
});

// === フィードバック ===
function showFeedback(data){
  let fb = "";
  const cmj = parseFloat(data.cmj)||0;
  const rsi = parseFloat(data.rsi)||0;
  const hr  = parseFloat(data.maxHR)||0;
  const rec = parseFloat(data.recovery)||0;
  const rpe = parseFloat(data.rpe)||0;

  if(cmj && cmj<64) fb += "出力発揮低下（股関節リード・リブ下制を再確認）<br>";
  if(rsi && rsi<2.2) fb += "反応性低下（リブシフト・ベアで再活性）<br>";
  if(hr>90 && rec>25) fb += "回復課題：呼吸・心拍制御強化。<br>";
  if(hr<85 && rpe>=8) fb += "主観負荷過多：動作効率の見直し。<br>";
  if(!fb) fb = "良好：出力・反応・回復バランス安定。";

  document.getElementById('feedback').innerHTML = fb;
}

// === 初回ロード ===
window.addEventListener('load',()=>{
  if(!localStorage.getItem('initShown')){
    alert('Next Season Fitness｜初期設定完了');
    localStorage.setItem('initShown','1');
  }
  const saved = localStorage.getItem('fitnessLog');
  if(saved){
    const d = JSON.parse(saved);
    document.getElementById('cmj').value = d.cmj || "";
    document.getElementById('rsi').value = d.rsi || "";
    document.getElementById('avgHR').value = d.avgHR || "";
    document.getElementById('maxHR').value = d.maxHR || "";
    document.getElementById('recoveryTime').value = d.recovery || "";
    rpeSlider.value = d.rpe || 0;
    rpeVal.textContent = "RPE: " + (d.rpe || 0);
    document.getElementById('comment').value = d.comment || "";
    showFeedback(d);
  }
});
</script>
</body>
</html>
